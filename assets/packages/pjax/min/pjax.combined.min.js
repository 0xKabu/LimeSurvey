!function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?module.exports=factory():"function"==typeof define&&define.amd?define(factory):(global=global||self).Pjax=factory()}(this,function(){"use strict";function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Constructor}function _toConsumableArray(arr){return function(arr){if(Array.isArray(arr)){for(var i=0,arr2=new Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}}(arr)||function(iter){if(Symbol.iterator in Object(iter)||"[object Arguments]"===Object.prototype.toString.call(iter))return Array.from(iter)}(arr)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}Array.prototype.from||(Array.prototype.from=function(enumerable){for(var arr=[],i=enumerable.length;i--;arr.unshift(enumerable[i]));return arr});var counter,forEachEls=function(els,fn,ctx){return els instanceof HTMLCollection||els instanceof NodeList||els instanceof Array?Array.prototype.from(els).forEach(function(el){return fn.call(ctx,el)}):fn.call(ctx,els)},getElements=function(el){return el.querySelectorAll(this.options.elements)},clone=function(obj){if(null===obj||"object"!=_typeof(obj))return obj;var copy=obj.constructor();for(var attr in obj)attr in obj&&(copy[attr]=obj[attr]);return copy},isSupported=function(){return window.history&&window.history.pushState&&window.history.replaceState&&!navigator.userAgent.match(/((iPod|iPhone|iPad).+\bOS\s+[1-4]\D|WebApps\/.+CFNetwork)/)},newUid=(counter=0,function(){var id="pjax"+(new Date).getTime()+"_"+counter;return counter++,id});function on(els,events,listener,useCapture){(events="string"==typeof events?events.split(" "):events).forEach(function(e){forEachEls(els,function(el){el.addEventListener(e,listener,useCapture)})})}var ConsoleShim=function(){function ConsoleShim(){var param=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",silencer=1<arguments.length&&void 0!==arguments[1]&&arguments[1];_classCallCheck(this,ConsoleShim),this.param=param,this.silencer=silencer,this.collector=[],this.currentGroupDescription="",this.activeGroups=0,this.timeHolder=null,this.methods=["group","groupEnd","log","trace","time","timeEnd","error","warn"],this.silent={group:function(){},groupEnd:function(){},log:function(){},trace:function(){},time:function(){},timeEnd:function(){},error:function(){},err:function(){},debug:function(){},warn:function(){}}}return _createClass(ConsoleShim,[{key:"_generateError",value:function(){try{throw new Error}catch(err){return err}}},{key:"_insertParamToArguments",value:function(rawArgs){if(""===this.param)return Array.from(arguments);var args=_toConsumableArray(rawArgs);return args.unshift(this.param),args}},{key:"setSilent",value:function(argument_0){var newValue=0<arguments.length&&void 0!==argument_0?argument_0:null;this.silencer=newValue||!this.silencer}},{key:"group",value:function(){if(!this.silencer){var args=this._insertParamToArguments(arguments);if("function"!=typeof console.group){var description=args[0]||"GROUP";this.currentGroupDescription=description,this.activeGroups++}else console.group.apply(console,args)}}},{key:"groupEnd",value:function(){if(!this.silencer){var args=this._insertParamToArguments(arguments);"function"!=typeof console.groupEnd?(this.currentGroupDescription="",this.activeGroups--,this.activeGroups=0===this.activeGroups?0:this.activeGroups--):console.groupEnd.apply(console,args)}}},{key:"log",value:function(){if(!this.silencer){var args=this._insertParamToArguments(arguments);"function"!=typeof console.group?(args.shift(),args.unshift(" ".repeat(2*this.activeGroups)),this.log.apply(this,args)):console.log.apply(console,args)}}},{key:"trace",value:function(){if(!this.silencer){var args=this._insertParamToArguments(arguments);if("function"!=typeof console.trace){var artificialError=this._generateError();artificialError.stack?this.log.apply(console,artificialError.stack):(this.log.log(args),null!=arguments.callee&&this.trace.apply(console,arguments.callee))}else console.trace.apply(console,args)}}},{key:"time",value:function(){if(!this.silencer){var args=this._insertParamToArguments(arguments);"function"!=typeof console.time?this.timeHolder=new Date:console.time.apply(console,args)}}},{key:"timeEnd",value:function(){if(!this.silencer){var args=this._insertParamToArguments(arguments);if("function"!=typeof console.timeEnd){var diff=new Date-this.timeHolder;this.log.log("Took ".concat(Math.floor(diff/36e5)," hours, ").concat(Math.floor(diff/6e4)," minutes and ").concat(Math.floor(diff/1e3)," seconds ( ").concat(diff," ms)")),this.time=new Date}else console.timeEnd.apply(console,args)}}},{key:"error",value:function(){var args=this._insertParamToArguments(arguments);"function"!=typeof console.error?(this.log.log("--- ERROR ---"),this.log.log(args)):console.error.apply(console,args)}},{key:"warn",value:function(){var args=this._insertParamToArguments(arguments);"function"!=typeof console.warn?(this.log.log("--- WARN ---"),this.log.log(args)):console.warn.apply(console,args)}}]),ConsoleShim}();function trigger(els,events,opts){(events="string"==typeof events?events.split(" "):events).forEach(function(e){var event;(event=document.createEvent("HTMLEvents")).initEvent(e,!0,!0),event.eventName=e,opts&&Object.keys(opts).forEach(function(key){event[key]=opts[key]}),forEachEls(els,function(el){var domFix=!1;el.parentNode||el===document||el===window||(domFix=!0,document.body.appendChild(el)),el.dispatchEvent(event),domFix&&el.parentNode.removeChild(el)})})}function doRequest(location,options,callback){var requestMethod=(options=options||{}).requestMethod||"GET",requestPayload=options.requestPayloadString||null,request=new XMLHttpRequest;return request.onreadystatechange=function(){4===request.readyState&&(200===request.status?callback(request.responseText,request):callback(null,request))},this.options.cacheBust&&(location+=(/[?&]/.test(location)?"&":"?")+(new Date).getTime()),request.open(requestMethod.toUpperCase(),location,!0),request.setRequestHeader("X-Requested-With","XMLHttpRequest"),null!=options.requestPayloadString&&""!=options.requestPayloadString&&request.setRequestHeader("Content-type","application/x-www-form-urlencoded"),request.send(requestPayload),request}var defaultSwitches={outerHTML:function(oldEl,newEl){oldEl.outerHTML=newEl.outerHTML,this.onSwitch()},innerHTML:function(oldEl,newEl){oldEl.innerHTML=newEl.innerHTML,oldEl.className=newEl.className,this.onSwitch()},sideBySide:function(oldEl,newEl,options,switchOptions){var elsToRemove=[],elsToAdd=[],fragToAppend=document.createDocumentFragment(),animationEventNames="animationend webkitAnimationEnd MSAnimationEnd oanimationend",animatedElsNumber=0,sexyAnimationEnd=function(e){e.target==e.currentTarget&&--animatedElsNumber<=0&&elsToRemove&&(elsToRemove.forEach(function(el){el.parentNode&&el.parentNode.removeChild(el)}),elsToAdd.forEach(function(el){el.className=el.className.replace(el.getAttribute("data-pjax-classes"),""),el.removeAttribute("data-pjax-classes")}),elsToRemove=elsToAdd=null,this.onSwitch())}.bind(this);switchOptions=switchOptions||{},Array.from(oldEl.childNodes).forEach(function(el){elsToRemove.push(el),el.classList&&!el.classList.contains("js-Pjax-remove")&&(el.hasAttribute("data-pjax-classes")&&(el.className=el.className.replace(el.getAttribute("data-pjax-classes"),""),el.removeAttribute("data-pjax-classes")),el.classList.add("js-Pjax-remove"),switchOptions.callbacks&&switchOptions.callbacks.removeElement&&switchOptions.callbacks.removeElement(el),switchOptions.classNames&&(el.className+=" "+switchOptions.classNames.remove+" "+(options.backward?switchOptions.classNames.backward:switchOptions.classNames.forward)),animatedElsNumber++,on(el,animationEventNames,sexyAnimationEnd,!0))}),Array.from(newEl.childNodes).forEach(function(el){if(el.classList){var addClasses="";switchOptions.classNames&&(addClasses=" js-Pjax-add "+switchOptions.classNames.add+" "+(options.backward?switchOptions.classNames.forward:switchOptions.classNames.backward)),switchOptions.callbacks&&switchOptions.callbacks.addElement&&switchOptions.callbacks.addElement(el),el.className+=addClasses,el.setAttribute("data-pjax-classes",addClasses),elsToAdd.push(el),fragToAppend.appendChild(el),animatedElsNumber++,on(el,animationEventNames,sexyAnimationEnd,!0)}}),oldEl.className=newEl.className,oldEl.appendChild(fragToAppend)}};Function.prototype.bind||(Function.prototype.bind=function(oThis){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var aArgs=Array.prototype.slice.call(arguments,1),that=this,Fnoop=function(){},fBound=function(){return that.apply(this instanceof Fnoop&&oThis?this:oThis,aArgs.concat(Array.prototype.slice.call(arguments)))};return Fnoop.prototype=this.prototype,fBound.prototype=new Fnoop,fBound});var attrClick="data-pjax-click-state",attrKey="data-pjax-keyup-state",linkAction=function(el,event){if(1<event.which||event.metaKey||event.ctrlKey||event.shiftKey||event.altKey)el.setAttribute(attrClick,"modifier");else if(el.protocol===window.location.protocol&&el.host===window.location.host)if(el.pathname===window.location.pathname&&0<el.hash.length)el.setAttribute(attrClick,"anchor-present");else if(el.hash&&el.href.replace(el.hash,"")===window.location.href.replace(location.hash,""))el.setAttribute(attrClick,"anchor");else if(el.href!==window.location.href.split("#")[0]+"#"){if(event.preventDefault(),this.options.currentUrlFullReload&&el.href===window.location.href.split("#")[0])return el.setAttribute(attrClick,"reload"),void this.reload();this.options.requestOptions=this.options.requestOptions||{},el.setAttribute(attrClick,"load"),this.loadUrl(el.href,clone(this.options))}else el.setAttribute(attrClick,"anchor-empty");else el.setAttribute(attrClick,"external")},isDefaultPrevented=function(event){return event.defaultPrevented||!1===event.returnValue};var attrClick$1="data-pjax-submit-state",formAction=function(el,event){this.options.requestOptions={requestUrl:el.getAttribute("action")||window.location.href,requestMethod:el.getAttribute("method")||"GET"};var virtLinkElement=document.createElement("a");if(virtLinkElement.setAttribute("href",this.options.requestOptions.requestUrl),virtLinkElement.protocol===window.location.protocol&&virtLinkElement.host===window.location.host)if(virtLinkElement.pathname===window.location.pathname&&0<virtLinkElement.hash.length)el.setAttribute(attrClick$1,"anchor-present");else if(virtLinkElement.href!==window.location.href.split("#")[0]+"#")if(this.options.currentUrlFullReload)el.setAttribute(attrClick$1,"reload");else{event.preventDefault();var nameList=[],paramObject=[];for(var elementKey in el.elements){var element=el.elements[elementKey];if(element.name&&void 0!==element.attributes&&"button"!==element.tagName.toLowerCase()&&("checkbox"!==element.type&&"radio"!==element.type||element.checked)&&-1===nameList.indexOf(element.name)){if(nameList.push(element.name),"select"===String(element.nodeName).toLowerCase()&&1==element.multiple){var selected=Array.from(element.options).map(function(item){return item.selected?item.value:null});return void paramObject.push({name:encodeURIComponent(element.name),value:selected})}paramObject.push({name:encodeURIComponent(element.name),value:encodeURIComponent(element.value)})}}var paramsString=paramObject.map(function(value){return value.name+"="+value.value}).join("&");this.options.requestOptions.requestPayload=paramObject,this.options.requestOptions.requestPayloadString=paramsString,el.setAttribute(attrClick$1,"submit"),this.loadUrl(virtLinkElement.href,clone(this.options))}else el.setAttribute(attrClick$1,"anchor-empty");else el.setAttribute(attrClick$1,"external")},isDefaultPrevented$1=function(event){return event.defaultPrevented||!1===event.returnValue};var commonjsGlobal="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};var module;!function(module){function noop(){}function Promise(fn){if(!(this instanceof Promise))throw new TypeError("Promises must be constructed via new");if("function"!=typeof fn)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],doResolve(fn,this)}function handle(self,deferred){for(;3===self._state;)self=self._value;0!==self._state?(self._handled=!0,Promise._immediateFn(function(){var cb=1===self._state?deferred.onFulfilled:deferred.onRejected;if(null!==cb){var ret;try{ret=cb(self._value)}catch(e){return void reject(deferred.promise,e)}resolve(deferred.promise,ret)}else(1===self._state?resolve:reject)(deferred.promise,self._value)})):self._deferreds.push(deferred)}function resolve(self,newValue){try{if(newValue===self)throw new TypeError("A promise cannot be resolved with itself.");if(newValue&&("object"==typeof newValue||"function"==typeof newValue)){var then=newValue.then;if(newValue instanceof Promise)return self._state=3,self._value=newValue,void finale(self);if("function"==typeof then)return void doResolve(function(fn,thisArg){return function(){fn.apply(thisArg,arguments)}}(then,newValue),self)}self._state=1,self._value=newValue,finale(self)}catch(e){reject(self,e)}}function reject(self,newValue){self._state=2,self._value=newValue,finale(self)}function finale(self){2===self._state&&0===self._deferreds.length&&Promise._immediateFn(function(){self._handled||Promise._unhandledRejectionFn(self._value)});for(var i=0,len=self._deferreds.length;i<len;i++)handle(self,self._deferreds[i]);self._deferreds=null}function Handler(onFulfilled,onRejected,promise){this.onFulfilled="function"==typeof onFulfilled?onFulfilled:null,this.onRejected="function"==typeof onRejected?onRejected:null,this.promise=promise}function doResolve(fn,self){var done=!1;try{fn(function(value){done||(done=!0,resolve(self,value))},function(reason){done||(done=!0,reject(self,reason))})}catch(ex){if(done)return;done=!0,reject(self,ex)}}var root,setTimeoutFunc;root=commonjsGlobal,setTimeoutFunc=setTimeout,Promise.prototype.catch=function(onRejected){return this.then(null,onRejected)},Promise.prototype.then=function(onFulfilled,onRejected){var prom=new this.constructor(noop);return handle(this,new Handler(onFulfilled,onRejected,prom)),prom},Promise.all=function(arr){return new Promise(function(resolve,reject){if(!arr||void 0===arr.length)throw new TypeError("Promise.all accepts an array");var args=Array.prototype.slice.call(arr);if(0===args.length)return resolve([]);var remaining=args.length;function res(i,val){try{if(val&&("object"==typeof val||"function"==typeof val)){var then=val.then;if("function"==typeof then)return void then.call(val,function(val){res(i,val)},reject)}args[i]=val,0==--remaining&&resolve(args)}catch(ex){reject(ex)}}for(var i=0;i<args.length;i++)res(i,args[i])})},Promise.resolve=function(value){return value&&"object"==typeof value&&value.constructor===Promise?value:new Promise(function(resolve){resolve(value)})},Promise.reject=function(value){return new Promise(function(resolve,reject){reject(value)})},Promise.race=function(values){return new Promise(function(resolve,reject){for(var i=0,len=values.length;i<len;i++)values[i].then(resolve,reject)})},Promise._immediateFn="function"==typeof setImmediate&&function(fn){setImmediate(fn)}||function(fn){setTimeoutFunc(fn,0)},Promise._unhandledRejectionFn=function(err){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",err)},Promise._setImmediateFn=function(fn){Promise._immediateFn=fn},Promise._setUnhandledRejectionFn=function(fn){Promise._unhandledRejectionFn=fn},module.exports?module.exports=Promise:root.Promise||(root.Promise=Promise)}(module={exports:{}});function evalScript(el){var querySelector=this.options.mainScriptElement,code=el.text||el.textContent||el.innerHTML||"";if(this.log.log("Evaluating Script: ",el),code.match("document.write"))return console&&this.options.logObject.log&&this.options.logObject.log("Script contains document.write. Can’t be executed correctly. Code skipped ",el),!1;var src=el.src||"",parent=el.parentNode||document.querySelector(querySelector)||document.documentElement,script=document.createElement("script"),promise=new Promise(function(resolve){if(script.type="text/javascript",""!=src&&(script.src=src,script.addEventListener("load",function(){resolve(src)}),script.async=!0),""!=code){try{script.appendChild(document.createTextNode(code))}catch(e){script.text=code}resolve("text-node")}});return this.log.log("ParentElement => ",parent),parent.appendChild(script),parent.removeChild(script),0<["head","body"].indexOf(parent.tagName.toLowerCase())||this.options.removeScriptsAfterParsing,promise}function off(els,events,listener,useCapture){(events="string"==typeof events?events.split(" "):events).forEach(function(e){forEachEls(els,function(el){el.removeEventListener(e,listener,useCapture)})})}var attrClick$2="data-pjax-click-state",attrKey$1="data-pjax-keyup-state",linkAction$1=function(el,event){if(1<event.which||event.metaKey||event.ctrlKey||event.shiftKey||event.altKey)el.setAttribute(attrClick$2,"modifier");else if(el.protocol===window.location.protocol&&el.host===window.location.host)if(el.pathname===window.location.pathname&&0<el.hash.length)el.setAttribute(attrClick$2,"anchor-present");else if(el.hash&&el.href.replace(el.hash,"")===window.location.href.replace(location.hash,""))el.setAttribute(attrClick$2,"anchor");else if(el.href!==window.location.href.split("#")[0]+"#"){if(event.preventDefault(),this.options.currentUrlFullReload&&el.href===window.location.href.split("#")[0])return el.setAttribute(attrClick$2,"reload"),void this.reload();this.options.requestOptions=this.options.requestOptions||{},el.setAttribute(attrClick$2,"load"),this.loadUrl(el.href,clone(this.options))}else el.setAttribute(attrClick$2,"anchor-empty");else el.setAttribute(attrClick$2,"external")},isDefaultPrevented$2=function(event){return event.defaultPrevented||!1===event.returnValue};var attrClick$3="data-pjax-click-state",formAction$1=function(el,event){this.options.requestOptions={requestUrl:el.getAttribute("action")||window.location.href,requestMethod:el.getAttribute("method")||"GET"};var virtLinkElement=document.createElement("a");if(virtLinkElement.setAttribute("href",this.options.requestOptions.requestUrl),virtLinkElement.protocol===window.location.protocol&&virtLinkElement.host===window.location.host)if(virtLinkElement.pathname===window.location.pathname&&0<virtLinkElement.hash.length)el.setAttribute(attrClick$3,"anchor-present");else if(virtLinkElement.href!==window.location.href.split("#")[0]+"#")if(this.options.currentUrlFullReload)el.setAttribute(attrClick$3,"reload");else{event.preventDefault();var nameList=[],paramObject=[];for(var elementKey in el.elements){var element=el.elements[elementKey];element.name&&void 0!==element.attributes&&"button"!==element.tagName.toLowerCase()&&("checkbox"!==element.type&&"radio"!==element.type||element.checked)&&-1===nameList.indexOf(element.name)&&(nameList.push(element.name),paramObject.push({name:encodeURIComponent(element.name),value:encodeURIComponent(element.value)}))}var paramsString=paramObject.map(function(value){return value.name+"="+value.value}).join("&");this.options.requestOptions.requestPayload=paramObject,this.options.requestOptions.requestPayloadString=paramsString,el.setAttribute(attrClick$3,"submit"),this.loadUrl(virtLinkElement.href,clone(this.options))}else el.setAttribute(attrClick$3,"anchor-empty");else el.setAttribute(attrClick$3,"external")},isDefaultPrevented$3=function(event){return event.defaultPrevented||!1===event.returnValue};return new function(){var Pjax=function(){function Pjax(options){var _this=this;return _classCallCheck(this,Pjax),this.firstrun=!0,this.oUtilities={forEachEls:forEachEls,getElements:getElements,clone:clone,isSupported:isSupported,newUid:newUid},this.oDomUtils=function(){var _this=this;return{refresh:function(el){_this.parseDOM(el||document)},reload:function(){window.location.reload()},foreachSelectors:function(selectors,cb,context,DOMcontext){DOMcontext=DOMcontext||document,selectors.forEach(function(selector){forEachEls(DOMcontext.querySelectorAll(selector),cb,context)})},unattach:function(el){forEachEls(_this.getElements(el),function(el){off(el,"click"),off(el,"keyup")},_this)}}}.call(this),this.oParsers=function(){return{parseElementUnload:function(el){switch(el.tagName.toLowerCase()){case"a":el.hasAttribute("data-pjax-click-state")||this.unattachLink(el);break;case"form":el.hasAttribute("data-pjax-click-state")||this.unattachForm(el);break;default:throw"Pjax can only be applied on <a> or <form> submit"}},parseElement:function(el){switch(el.tagName.toLowerCase()){case"a":el.hasAttribute("data-pjax-click-state")||this.attachLink(el);break;case"form":el.hasAttribute("data-pjax-click-state")||this.attachForm(el);break;default:throw"Pjax can only be applied on <a> or <form> submit"}},parseDOMUnload:function(el){forEachEls(this.getElements(el),this.parseElementUnload,this)},parseDOM:function(el){forEachEls(this.getElements(el),this.parseElement,this)},parseOptions:function(options){this.options=options,this.options.elements=this.options.elements||"a[href], form[action]",this.options.reRenderCSS=this.options.reRenderCSS||!1,this.options.forceRedirectOnFail=this.options.forceRedirectOnFail||!1,this.options.scriptloadtimeout=this.options.scriptloadtimeout||1e3,this.options.mainScriptElement=this.options.mainScriptElement||"head",this.options.removeScriptsAfterParsing=this.options.removeScriptsAfterParsing||!0,this.options.logObject=this.options.logObject||console,this.options.latestChance=this.options.latestChance||null,this.options.selectors=this.options.selectors||["title",".js-Pjax"],this.options.switches=this.options.switches||{},this.options.switchesOptions=this.options.switchesOptions||{},this.options.history=this.options.history||!0,this.options.onDomDiffers=this.options.onDomDiffers||function(){return!0},this.options.pjaxErrorHandler=this.options.pjaxErrorHandler||function(){return!1},this.options.onJsonDocument=this.options.onJsonDocument||function(){return!0},this.options.analytics=this.options.analytics||function(){window._gaq&&window._gaq.push(["_trackPageview"]),window.ga&&window.ga("send","pageview",{page:location.pathname,title:document.title})},this.options.scrollTo=void 0===this.options.scrollTo?0:this.options.scrollTo,this.options.cacheBust=void 0===this.options.cacheBust||this.options.cacheBust,this.options.debug=this.options.debug||!1,this.options.switches.head||(this.options.switches.head=this.switchElementsAlt),this.options.switches.body||(this.options.switches.body=this.switchElementsAlt),"function"!=typeof options.analytics&&(options.analytics=function(){})}}}.call(this),this.oParsers.parseOptions.call(this,options),this.log=function(){return console.log("PJAX options",this.options),this.options.logObject=new ConsoleShim("PJAX ->",!this.options.debug),this.options.logObject}.call(this),this.doRequest=doRequest,this.getElements=this.oUtilities.getElements,this.parseElementUnload=this.oParsers.parseElementUnload,this.parseElement=this.oParsers.parseElement,this.parseDOM=this.oParsers.parseDOM,this.parseDOMUnload=this.oParsers.parseDOMUnload,this.refresh=this.oDomUtils.refresh,this.reload=this.oDomUtils.reload,this.isSupported=this.oUtilities.isSupported,this.attachLink=function(){var _this=this;return function(el){on(el,"click",function(event){isDefaultPrevented(event)||linkAction.call(_this,el,event)}),on(el,"keyup",function(event){isDefaultPrevented(event)||(1<event.which||event.metaKey||event.ctrlKey||event.shiftKey||event.altKey?el.setAttribute(attrKey,"modifier"):13==event.keyCode&&linkAction.call(_this,el,event))})}}.call(this),this.attachForm=function(){var _this=this;return function(el){on(el,"submit",function(event){isDefaultPrevented$1(event)||formAction.call(_this,el,event)})}}.call(this),this.unattachLink=function(){var _this=this;return function(el){off(el,"click",function(event){isDefaultPrevented$2(event)||linkAction$1.call(_this,el,event)}),off(el,"keyup",function(event){isDefaultPrevented$2(event)||(1<event.which||event.metaKey||event.ctrlKey||event.shiftKey||event.altKey?el.setAttribute(attrKey$1,"modifier"):13==event.keyCode&&linkAction$1.call(_this,el,event))})}}.call(this),this.unattachForm=function(){var _this=this;return function(el){off(el,"submit",function(event){isDefaultPrevented$3(event)||formAction$1.call(this,el,event)}),off(el,"keyup",function(event){isDefaultPrevented$3(event)||13==event.keyCode&&formAction$1.call(_this,el,event)})}}.call(this),this.updateStylesheets=function(){var _this=this;return function(elements,oldElements){_this.log.log("styleheets old elements",oldElements),_this.log.log("styleheets new elements",elements),forEachEls(elements,function(newEl){if(null!==Array.from(oldElements).reduce(function(acc,oldEl){return acc=oldEl.href===newEl.href?oldEl:acc},null))_this.log&&_this.log.log("old stylesheet found not resetting");else{_this.log&&_this.log.log("new stylesheet => add to head");var head=document.getElementsByTagName("head")[0],link=document.createElement("link");link.setAttribute("href",newEl.href),link.setAttribute("rel","stylesheet"),link.setAttribute("type","text/css"),head.appendChild(link)}})}}.call(this),this.log.log("Pjax options",this.options),this.maxUid=this.lastUid=this.oUtilities.newUid(),this.parseDOM(document),on(window,"popstate",function(st){if(_this.log.log("OPT -> ",st),st.state){var opt=_this.oUtilities.clone(_this.options);opt.url=st.state.url,opt.title=st.state.title,opt.history=!1,opt.requestOptions={},_this.log.log("OPT -> ",opt),_this.log.log("State UID",st.state.uid),_this.log.log("lastUID",_this.lastUid),st.state.uid<_this.lastUid?opt.backward=!0:opt.forward=!0,_this.lastUid=st.state.uid,_this.loadUrl(st.state.url,opt)}}),this}return _createClass(Pjax,[{key:"forEachSelectors",value:function(cb,context,DOMcontext){return this.oDomUtils.foreachSelectors(this.options.selectors,cb,context,DOMcontext)}},{key:"switchSelectors",value:function(selectors,fromEl,toEl,options){return function(){var _this=this;return function(switches,switchesOptions,selectors,fromEl,toEl,options){selectors.forEach(function(selector){var newEls=fromEl.querySelectorAll(selector),oldEls=toEl.querySelectorAll(selector);if((_this.log.log("Pjax switch",selector,newEls,oldEls),newEls.length!==oldEls.length)&&options.onDomDiffers(toEl,fromEl))throw"DOM doesn’t look the same on new loaded page: ’"+selector+"’ - new "+newEls.length+", old "+oldEls.length;forEachEls(newEls,function(newEl,i){var oldEl=oldEls[i];this.log.log("newEl",newEl,"oldEl",oldEl),switches[selector]?switches[selector].call(this,oldEl,newEl,options,switchesOptions[selector]):defaultSwitches.outerHTML(oldEl,newEl,options)},_this)})}}.call(this)(this.options.switches,this.options.switchesOptions,selectors,fromEl,toEl,options)}},{key:"latestChance",value:function(href){return window.location.href=href,!1}},{key:"onSwitch",value:function(){trigger(window,"resize scroll")}},{key:"loadContent",value:function(html,options){var _this2=this,fnExecuteScripts=function(){var _this=this;return function(el){_this.log.log("Executing scripts for ",el);var loadingScripts=[];return void 0===el?Promise.resolve():("script"===el.tagName.toLowerCase()&&evalScript.call(_this,el),forEachEls(el.querySelectorAll("script"),function(script){script.type&&"text/javascript"!==script.type.toLowerCase()||script.parentNode&&"textarea"==script.parentNode.tagName||loadingScripts.push(evalScript.call(_this,script))},_this),loadingScripts)}}.apply(this),tmpEl=document.implementation.createHTMLDocument("pjax"),collectForScriptcomplete=[Promise.resolve("basic resolve")],matches=html.match(/<html[^>]+>/gi);matches&&matches.length&&(matches=matches[0].match(/\s?[a-z:]+(?:=(?:'|")[^'">]+(?:'|"))*/gi)).length&&(matches.shift(),matches.forEach(function(htmlAttrib){var attr=htmlAttrib.trim().split("=");1===attr.length?tmpEl.documentElement.setAttribute(attr[0],!0):tmpEl.documentElement.setAttribute(attr[0],attr[1].slice(1,-1))}));var jsonContent=null;try{jsonContent=JSON.parse(html)}catch(e){this.log.warn("No JSON found. If you expected it there was an error")}if(tmpEl.documentElement.innerHTML=html,this.log.log("load content",tmpEl.documentElement.attributes,tmpEl.documentElement.innerHTML.length),null!==jsonContent&&(this.log.log("found JSON document",jsonContent),this.options.onJsonDocument.call(this,jsonContent)),document.activeElement&&!document.activeElement.value)try{document.activeElement.blur()}catch(e){}this.switchSelectors(this.options.selectors,tmpEl,document,options),!0===this.options.reRenderCSS&&this.updateStylesheets(tmpEl.querySelectorAll("link[rel=stylesheet]"),document.querySelectorAll("link[rel=stylesheet]"));var autofocusEl=Array.prototype.slice.call(document.querySelectorAll("[autofocus]")).pop();autofocusEl&&document.activeElement!==autofocusEl&&autofocusEl.focus(),this.options.selectors.forEach(function(selector){_this2.oUtilities.forEachEls(document.querySelectorAll(selector),function(el){collectForScriptcomplete.push.apply(collectForScriptcomplete,fnExecuteScripts(el))},_this2)}),this.log.log("waiting for scriptcomplete",collectForScriptcomplete);var timeOutScriptEvent=null;timeOutScriptEvent=window.setTimeout(function(){trigger(document,"pjax:scriptcomplete pjax:scripttimeout",options),timeOutScriptEvent=null},this.options.scriptloadtimeout),Promise.all(collectForScriptcomplete).then(function(){null!==timeOutScriptEvent&&(window.clearTimeout(timeOutScriptEvent),trigger(document,"pjax:scriptcomplete pjax:scriptsuccess",options))},function(){null!==timeOutScriptEvent&&(window.clearTimeout(timeOutScriptEvent),trigger(document,"pjax:scriptcomplete pjax:scripterror",options))})}},{key:"loadUrl",value:function(href,options){var _this3=this;this.log.log("load href",href,options),trigger(document,"pjax:send",options),this.doRequest(href,options.requestOptions,function(html,requestData){if(!1===html||200!==requestData.status)return trigger(document,"pjax:complete pjax:error",{options:options,requestData:requestData,href:href}),options.pjaxErrorHandler(href,options,requestData);document.activeElement.blur();try{_this3.loadContent(html,options)}catch(e){if(_this3.options.debug){if(_this3.options.forceRedirectOnFail)return options.pjaxErrorHandler(href,options,requestData)||_this3.latestChance(href);throw e}return console&&_this3.options.logObject.error&&_this3.options.logObject.error("Pjax switch fail: ",e),options.pjaxErrorHandler(href,options,requestData)||_this3.latestChance(href)}options.history&&(_this3.firstrun&&(_this3.lastUid=_this3.maxUid=_this3.oUtilities.newUid(),_this3.firstrun=!1,window.history.replaceState({url:window.location.href,title:document.title,uid:_this3.maxUid},document.title)),_this3.lastUid=_this3.maxUid=_this3.oUtilities.newUid(),window.history.pushState({url:href,title:options.title,uid:_this3.maxUid},options.title,href)),_this3.forEachSelectors(function(el){return _this3.parseDOM(el)}),trigger(document,"pjax:complete pjax:success",options),options.analytics(),!1!==options.scrollTo&&(1<options.scrollTo.length?window.scrollTo(options.scrollTo[0],options.scrollTo[1]):window.scrollTo(0,options.scrollTo))})}}]),Pjax}();if(isSupported())return Pjax;console.warn("Pjax not supported");var stupidPjax=function(){};for(var key in Pjax.prototype)key in Pjax.prototype&&"function"==typeof Pjax.prototype[key]&&(stupidPjax[key]=stupidPjax);return stupidPjax}});var switchOuterHTML=function(oldEl,newEl,opt){var parent=$(oldEl).parent();$(oldEl).off().remove(),parent.append(newEl),this.onSwitch()},switchInnerHTML=function(oldEl,newEl,opt){$(oldEl).parent();$(oldEl).off().html(""),$(oldEl).html($(newEl).html()),this.onSwitch()},singletonPjax=function(){return window.activePjax=window.activePjax||null,null===window.activePjax&&(console.ls.log("creating a Pjax instance on the window object"),window.activePjax=new Pjax({elements:["a.pjax","form.pjax"],selectors:["#pjax-content","#breadcrumb-container","#bottomScripts","#beginScripts"],debug:!0,forceRedirectOnFail:!1,reRenderCSS:!0,scriptloadtimeout:1500})),window.activePjax},forceRefreshPjax=function(){window.activePjax=null,singletonPjax()},unsetPjax=function(){window.activePjax.parseDOMtoUnload(),$("a.pjax").off("click"),window.activePjax=null},triggerLoadUrl=function(e,data){singletonPjax().loadUrl(data.url,singletonPjax().options)},reparseDocument=function(){singletonPjax().parseDOM(document)};window.singletonPjax=singletonPjax,$(document).off("pjax:reload"),$(document).off("pjax:create"),$(document).off("pjax:refresh"),$(document).off("pjax:load"),$(document).off("pjax:unload"),$(document).on("pjax:reload",forceRefreshPjax),$(document).on("pjax:create",singletonPjax),$(document).on("pjax:refresh",reparseDocument),$(document).on("pjax:load",triggerLoadUrl),$(document).on("pjax:unload",unsetPjax);
